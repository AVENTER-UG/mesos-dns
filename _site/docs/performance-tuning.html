<!DOCTYPE html>
<html lang="en">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Mesos-DNS: Mesos-DNS Performance Tuning</title>
    <link rel="icon" type="image/x-icon" href="/mesos-dns/img/mesos-dns-favicon.ico">
    <link href="//cdn.jsdelivr.net/bootstrap/3.2.0/css/bootstrap.min.css" rel="stylesheet">
    <link href="/mesos-dns/css/style.css" rel="stylesheet">
  </head>
  <body>
    <div class="container">
      <div class="row">
        <div class="col-sm-10 col-sm-offset-1">
          <div class="navbar navbar-default navbar-inverse" role="navigation">
            <div class="container-fluid">
              <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar-collapse">
                  <span class="sr-only">Toggle navigation</span>
                  <span class="icon-bar"></span>
                  <span class="icon-bar"></span>
                  <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="/mesos-dns/">Mesos-DNS</a>
              </div>
              <div class="collapse navbar-collapse" id="navbar-collapse">
                <ul class="nav navbar-nav">
                  <li class="active">
                    <a href="/mesos-dns/docs/">Docs</a>
                  </li>
                  <li >
                    <a href="/mesos-dns/resources.html">Resources</a>
                  </li>
                  <li >
                    <a href="/mesos-dns/support.html">Support</a>
                  </li>
                </ul>
                <ul class="nav navbar-nav navbar-right">
                  <li><a href="https://github.com/AVENTER-UG/mesos-dns">GitHub</a></li>
                </ul>
              </div>
            </div>
          </div>
          <div class="row">
  <div class="col-sm-3">
    <h5>Documentation</h5>
    <ul class="list-unstyled">
      <li>
        <a href="/mesos-dns/docs/">
          Installing and running
        </a>
      </li>
       <li>
        <a href="/mesos-dns/docs/configuration-parameters.html">
        Configuration</a>
      </li>
       <li>
        <a href="/mesos-dns/docs/naming.html">
          Service Naming
        </a>
      </li>
       <li>
        <a href="/mesos-dns/docs/http.html">
          HTTP API
        </a>
      </li>
      <li>
        <a href="/mesos-dns/docs/performance-tuning.html">
          Performance Tuning
        </a>
      </li>
       <li>
        <a href="/mesos-dns/docs/faq.html">
          FAQ & Troubleshooting
        </a>
      </li>
    <hr>
    <h5>Tutorials</h5>
    <ul class="list-unstyled">
       <li>
        <a href="/mesos-dns/docs/tutorial.html">
        Mesos-DNS</a>
      </li>
       <li>
        <a href="/mesos-dns/docs/tutorial-forward.html">
        Mesos-DNS and Bind</a>
      </li>
       <li>
        <a href="/mesos-dns/docs/tutorial-systemd.html">
        Mesos-DNS using Systemd</a>
      </li>

    <hr>
    </ul>
<!---
    <h5>Resources</h5>
    <ul class="list-unstyled">
      <li>
        <a href="/mesos-dns/docs/deployment-design-doc.html">
          Deployment Design
        </a>
      </li>
    </ul>
    <hr>
    <h5>Upgrading</h5>
    <ul class="list-unstyled">
      <li>
        <a href="/mesos-dns/docs/upgrade/06xto070.html">
          0.6.x to 0.7.0
        </a>
      </li>
    </ul>
-->
  </div>
  <div class="col-sm-9">
    <h1 id="mesos-dns-performance-tuning">Mesos-DNS Performance Tuning</h1>

<p>Mesos-DNS is lightweight and can achieve high throughput with a small amount of resources. For example, our benchmarking on <a href="https://cloud.google.com/">Google Cloud Platform</a> shows that, using a single core of an <code class="language-plaintext highlighter-rouge">n1-standard-2</code> instance, it can serve up to 8.5K queries/second for lookups in the Mesos cluster domain. For many use cases, this should be sufficiently performant.</p>

<p>The following are suggestions for further performance tuning, focusing primarily on Linux systems.</p>

<h2 id="basic-tuning">Basic Tuning</h2>

<h3 id="gomaxprocs">GOMAXPROCS</h3>

<p>In Mesos-DNS 0.5.0, we’ve moved to Go <em>1.5</em>, which automatically sets <code class="language-plaintext highlighter-rouge">GOMAXPROCS</code> to the number of CPUs that are detected by the Go runtime via <code class="language-plaintext highlighter-rouge">runtime.NumCPU</code>.</p>

<p>In previous versions, it may make sense to increase the number of cores used by Mesos-DNS by setting the <code class="language-plaintext highlighter-rouge">GOMAXPROCS</code> environment variable. For instance, use the following command line to launch Mesos-DNS on 8 cores:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">GOMAXPROCS</span><span class="o">=</span>8 mesos-dns
</code></pre></div></div>

<h3 id="scaling-out">Scaling out</h3>

<p>If a single Mesos-DNS server cannot meet the performance requirements in a very large cluster, you can bring up multiple Mesos-DNS servers and configure a subset of the agent nodes to use each Mesos-DNS server. All Mesos-DNS servers will serve the same settings derived from the Mesos master state.</p>

<h3 id="fundamental-operating-system-limits">Fundamental Operating system limits</h3>

<p>You should also increase the shell limits for the maximum number of file descriptors and processes. Use <code class="language-plaintext highlighter-rouge">ulimit -a</code> to check the current settings and, if needed, increase them by executing the following shell commands before launching Mesos-DNS. Mesos-DNS uses file descriptors for forwarding queries, making requests to the Mesos master, and keeps file descriptors open for incoming queries.</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">ulimit</span> <span class="nt">-n</span> 65536
<span class="nb">ulimit</span> <span class="nt">-p</span> 16384
</code></pre></div></div>

<h2 id="tuning-external-lookups">Tuning External Lookups</h2>

<p>When Mesos-DNS receives lookup requests for a name outside the Mesos domain, it forwards them to an external nameserver. Depending on the external nameserver used and the network conditions, external requests can have significant latency and can pose a performance bottleneck.</p>

<p>Make sure you use a performant and reliable external nameserver. Its performance places an upper bound on Mesos-DNS for external requests. The <a href="https://developers.google.com/speed/public-dns/">Google public DNS</a> is a good option but keep in mind that it enforces <a href="https://developers.google.com/speed/public-dns/docs/security">request rate limits</a> for security reasons. You can also try other public nameservers from this <a href="http://public-dns.tk/nameservers">list</a>.</p>

<p>Increasing the shell limits can also be important for the performance of external requests.</p>

<h2 id="tuning-mesos-agents">Tuning Mesos Agents</h2>

<p>You can improve the performance of Mesos slaves by increasing shell limits as discussed above.</p>

<p>You can also install a DNS cache on each agent node, such as <a href="http://www.thekelleys.org.uk/dnsmasq/doc.html">dnsmasq</a> (see <a href="http://www.g-loaded.eu/2010/09/18/caching-nameserver-using-dnsmasq/">instructions</a>). This will limit the number of repeated requests reaching Mesos-DNS.</p>

  </div>
</div>

          <footer>
            <p class="text-muted">
              &copy; 2015 <a class="text-muted" href="http://mesosphere.com">Mesosphere, Inc.</a>
              &copy; 2021 <a class="text-muted" href="https://www.aventer.biz">AVENTER UG (haftungsbeschränkt).</a>
            </p>
          </footer>
        </div>
      </div>
    </div>
    <script src="//cdn.jsdelivr.net/jquery/2.1.1/jquery.min.js"></script>
    <script src="//cdn.jsdelivr.net/bootstrap/3.2.0/js/bootstrap.min.js"></script>
  </body>
</html>
